!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t){e.exports=function(e){for(var t,n,r=e.data,o=r.length,l=e.width,a=[],i=[],c=[],s=0;s<256;s++)a[s]=.299*s,i[s]=.587*s,c[s]=.11*s;for(var s=0;s<=o;s+=4)r[s]=Math.floor(a[r[s]]+i[r[s+1]]+c[r[s+2]]);for(var u=0;u<=o;u+=4)t=r[u]<150?0:255,n=Math.floor((r[u]-t)/23),r[u]=t,r[u+4]+=7*n,r[u+4*l-4]+=3*n,r[u+4*l]+=5*n,r[u+4*l+4]+=1*n,r[u+1]=r[u+2]=r[u];return e}},function(e,t,n){"use strict";n.r(t);var r=n(0),o=n.n(r);function l(e,t){return function(e,t){const n=e.data,r=n.length,l=e.height,a=e.width,i=(e.hasAlphaChannel,t.threshold||120),c=[],s=new Uint8Array(a*l/8);s.fill(0),t.dither&&o()(e);for(let e=0;e<r;e+=4){let t=n[e+1]=n[e+2]=n[e];const r=t>i?1:0;c[e/4]=r}for(let e=0;e<c.length;e++){const t=Math.floor(e%a),n=Math.floor(e/a),r=Math.floor(n/8),o=0===r?t:t+a*r,l=1<<n-8*r;0===c[e]?s[o]&=~l:s[o]|=l}return s}(e,t)}let a=[];const i=()=>a;let c;const s=({convertedFrames:e,w:t,h:n})=>{return((e,t)=>{const n=document.createElement("canvas");return n.id="frameCanvas",document.querySelector("#gifBox #preview").appendChild(n),n.width=e,n.height=t,n.getContext("2d")})(t,n)},u=(e,t,n,r)=>{const o=e.getImageData(0,0,n,r);for(let r=0;r<t.length;r++){for(let e=0;e<8;e++){let l=t[r]>>>e&1?255:0,a=4*(r%n+Math.floor(r/n)*n*8+e*n);o.data[a]=o.data[a+1]=o.data[a+2]=l,o.data[a+3]=255}e.putImageData(o,0,0)}},d=()=>{(()=>c&&clearInterval(c))(),f("","inherit"),v.style.display="none";const e=document.querySelector(".jsgif");e&&e.remove();const t=document.querySelector("#frameCanvas");t&&t.remove(),_.removeAllFiles()},h=e=>{const{width:t,height:n}=e,[r,o]=((e,t)=>{const n=y/e,r=m/t,o=Math.min(n,r);return[Math.ceil(o*e),Math.ceil(o*t)]})(t,n);return e.style.display="none",e.height=o,e.width=r,e},f=(e,t,n)=>{j.textContent=e,j.style.color=t,n&&(j.style.display=n)},p=e=>{d(),g.style.display="inline-block";const t=g.querySelector("#og").appendChild(h(e)),{width:n,height:r}=t;((e,t)=>new Promise((n,r)=>{const o=new SuperGif({gif:e,max_width:t,progressbar_height:0});o.load(()=>{const e=o.get_canvas().getContext("2d"),{height:t,width:r}=o.get_canvas(),l=o.get_length(),a=l>4,i=Math.min(4,l),c=[];for(let n=0;n<i;n+=1)o.move_to(n),c.push(e.getImageData(0,0,r,t));n([c,a])})}))(t,n).then(([e,t])=>((e=>{document.querySelector(".jsgif").style.height=`${e}px`})(r),t&&(v.style.display="block"),((e,t,n)=>{const{dither:r,threshold:o}=Object.assign({},{dither:!0,threshold:120});return{convertedFrames:a=e.map(e=>Array.prototype.slice.call(l(e,{dither:r,threshold:o}))),w:t,h:n}})(e,n,r))).then(s).then(e=>((e,t,n,r)=>{let o=0,l=t.length-1;c=setInterval(()=>{u(e,t[o],n,r),o=o<l?o+1:0},100)})(e,i(),n,r))},y=128,m=64,g=document.querySelector("#gifBox"),v=document.querySelector("#truncateWarning"),b=document.querySelector("#iothubWarning"),S=document.querySelector("form"),w=S.querySelector("#filename"),q=S.querySelector("#deviceChoice"),x=S.querySelector('input[type="submit"]'),M=S.querySelector("select"),j=S.querySelector("#sendStatus"),C=S.querySelector("#fileDropzone"),_=new Dropzone(document.body,{acceptedFiles:"image/gif",clickable:"button#fileDropzone",createImageThumbnails:!1,maxFiles:1,autoQueue:!1,url:"localhost",autoProcessQueue:!1,autoQueue:!1,previewTemplate:"<div></div>"});S.addEventListener("submit",e=>{e.preventDefault();const{width:t,height:n}=document.querySelector("#frameCanvas"),r=i(),o=M.value;f(`Sending GIF to ${o}...`,"inherit","block"),((e,t,n,r)=>{const o=JSON.stringify({deviceId:r,data:{size:[t,n],frames:e}});return fetch("/api/gif",{method:"POST",headers:{"Content-Type":"application/json"},body:o})})(r,t,n,o).then(e=>{e.ok?f("Sent!","mediumseagreen"):f("Could not send. Try again?","crimson")}).catch(e=>{console.log(e),f("Could not send. Try again?","crimson")})}),C.addEventListener("press",e=>e.preventDefault()),C.addEventListener("click",e=>e.preventDefault()),_.on("addedfile",function(e){w.textContent=e.name;const t=window.URL.createObjectURL(e),n=new Image;n.src=t,n.onload=(()=>p(n)),x.style.display="inline-block",q.style.display="block",_.removeFile(e)}),((e,t)=>{fetch("/api/devices/list").then(e=>e.json()).then(n=>{if(!n.length)return t.style.display="inline-block";const r=n.map(e=>`<option>${e}</option>`);e.innerHTML=r.join("\n")}).catch(console.error)})(M,b)}]);