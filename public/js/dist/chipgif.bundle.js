!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t){e.exports=function(e){for(var t,n,r=e.data,o=r.length,i=e.width,l=[],a=[],c=[],s=0;s<256;s++)l[s]=.299*s,a[s]=.587*s,c[s]=.11*s;for(var s=0;s<=o;s+=4)r[s]=Math.floor(l[r[s]]+a[r[s+1]]+c[r[s+2]]);for(var u=0;u<=o;u+=4)t=r[u]<150?0:255,n=Math.floor((r[u]-t)/23),r[u]=t,r[u+4]+=7*n,r[u+4*i-4]+=3*n,r[u+4*i]+=5*n,r[u+4*i+4]+=1*n,r[u+1]=r[u+2]=r[u];return e}},function(e,t,n){"use strict";n.r(t);var r=n(0),o=n.n(r);function i(e,t){return function(e,t){const n=e.data,r=n.length,i=e.height,l=e.width,a=(e.hasAlphaChannel,t.threshold||120),c=[],s=new Uint8Array(l*i/8);s.fill(0),t.dither&&o()(e);for(let e=0;e<r;e+=4){let t=n[e+1]=n[e+2]=n[e];const r=t>a?1:0;c[e/4]=r}for(let e=0;e<c.length;e++){const t=Math.floor(e%l),n=Math.floor(e/l),r=Math.floor(n/8),o=0===r?t:t+l*r,i=1<<n-8*r;0===c[e]?s[o]&=~i:s[o]|=i}return s}(e,t)}let l=[];const a=()=>l;let c;const s=({convertedFrames:e,w:t,h:n})=>{return((e,t)=>{const n=document.createElement("canvas");return n.id="frameCanvas",document.querySelector("#gifBox #preview").appendChild(n),n.width=e,n.height=t,n.getContext("2d")})(t,n)},u=(e,t,n,r)=>{const o=e.getImageData(0,0,n,r);for(let r=0;r<t.length;r++){for(let e=0;e<8;e++){let i=t[r]>>>e&1?255:0,l=4*(r%n+Math.floor(r/n)*n*8+e*n);o.data[l]=o.data[l+1]=o.data[l+2]=i,o.data[l+3]=255}e.putImageData(o,0,0)}},d=()=>{(()=>c&&clearInterval(c))(),f("","inherit"),v.style.display="none";const e=document.querySelector(".jsgif");e&&e.remove();const t=document.querySelector("#frameCanvas");t&&t.remove()},h=e=>{const{width:t,height:n}=e,[r,o]=((e,t)=>{const n=p/e,r=g/t,o=Math.min(n,r);return[Math.ceil(o*e),Math.ceil(o*t)]})(t,n);return e.style.display="none",e.height=o,e.width=r,e},f=(e,t,n)=>{_.textContent=e,_.style.color=t,n&&(_.style.display=n)},y=e=>{d(),m.style.display="inline-block";const t=m.querySelector("#og").appendChild(h(e)),{width:n,height:r}=t;((e,t)=>new Promise((n,r)=>{const o=new SuperGif({gif:e,max_width:t,progressbar_height:0});o.load(()=>{const e=o.get_canvas().getContext("2d"),{height:t,width:r}=o.get_canvas(),i=o.get_length(),l=i>4,a=Math.min(4,i),c=[];for(let n=0;n<a;n+=1)o.move_to(n),c.push(e.getImageData(0,0,r,t));n([c,l])})}))(t,n).then(([e,t])=>((e=>{document.querySelector(".jsgif").style.height=`${e}px`})(r),t&&(v.style.display="block"),((e,t,n)=>{const{dither:r,threshold:o}=Object.assign({},{dither:!0,threshold:120});return{convertedFrames:l=e.map(e=>Array.prototype.slice.call(i(e,{dither:r,threshold:o}))),w:t,h:n}})(e,n,r))).then(s).then(e=>((e,t,n,r)=>{let o=0,i=t.length-1;c=setInterval(()=>{u(e,t[o],n,r),o=o<i?o+1:0},100)})(e,a(),n,r))},p=128,g=64,m=document.querySelector("#gifBox"),v=document.querySelector("#truncateWarning"),S=document.querySelector("#iothubWarning"),b=document.querySelector("form"),w=b.querySelector('input[type="file"]'),q=b.querySelector(".fileInputButton"),M=b.querySelector("#filename"),j=b.querySelector("#deviceChoice"),x=b.querySelector('input[type="submit"]'),C=b.querySelector("select"),_=b.querySelector("#sendStatus");b.addEventListener("submit",e=>{e.preventDefault();const{width:t,height:n}=document.querySelector("#frameCanvas"),r=a(),o=C.value;f(`Sending GIF to ${o}...`,"inherit","block"),((e,t,n,r)=>{const o=JSON.stringify({deviceId:r,data:{size:[t,n],frames:e}});return fetch("/api/gif",{method:"POST",headers:{"Content-Type":"application/json"},body:o})})(r,t,n,o).then(e=>{e.ok?f("Sent!","mediumseagreen"):f("Could not send. Try again?","crimson")}).catch(e=>{console.log(e),f("Could not send. Try again?","crimson")})}),w.addEventListener("change",function(){const e=this.files[0];M.textContent=e.name;const t=window.URL.createObjectURL(e),n=new Image;n.src=t,n.onload=(()=>y(n)),x.style.display="inline-block",j.style.display="block"}),q.addEventListener("click",e=>{e.preventDefault(),w.click()}),((e,t)=>{fetch("/api/devices/list").then(e=>e.json()).then(n=>{if(!n.length)return t.style.display="inline-block";const r=n.map(e=>`<option>${e}</option>`);e.innerHTML=r.join("\n")}).catch(console.error)})(C,S)}]);